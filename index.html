<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Philip's Book Diviner</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Creepster&family=Metal+Mania&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for Zoltar theme */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom right, #4a0e0e, #1a0505); /* Dark, mysterious background */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Prevent scrollbar from animation */
        }

        .zoltar-container {
            background-color: #2c0808; /* Darker background for the machine */
            border: 8px solid #8b4513; /* Wood-like border */
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), inset 0 0 15px rgba(255, 255, 255, 0.1);
            padding: 1.5rem 2rem; /* Adjusted padding for top image */
            max-width: 90%;
            width: 650px; /* Slightly wider to accommodate image */
            text-align: center;
            position: relative;
            z-index: 10;
            perspective: 1000px; /* For 3D flip effect */
        }

        .zoltar-header-image-container {
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .zoltar-header-image {
            max-width: 30%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .fortune-card-wrapper {
            position: relative;
            width: 250px; /* Fixed width for the card */
            height: 350px; /* Fixed height for the card */
            margin: 0 auto 2rem auto;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            transition: transform 0.6s ease-in-out, box-shadow 0.3s ease-in-out; /* Flip transition and glow */
            transform-style: preserve-3d; /* Keep children in 3D space */
            z-index: 100; /* Ensure it's above other content */
        }

        .fortune-card-wrapper.flipped {
            transform: rotateY(180deg);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7), 0 0 40px rgba(255, 215, 0, 0.4); /* Slightly reduced glow */
        }

        .fortune-card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; /* Hide the back of the face when rotated */
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem 1.5rem;
            box-sizing: border-box;
        }

        .fortune-card-front {
            background: linear-gradient(to bottom right, #8b0000, #4a0000); /* Dark red gradient */
            border: 4px solid #ffd700; /* Gold border */
            z-index: 2;
        }

        .fortune-card-back {
            background-color: #f5f5dc; /* Light parchment-like background */
            color: #333;
            border: 4px solid #8b4513; /* Wood border */
            transform: rotateY(180deg); /* Initially rotated to be the back */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Align content to top for book details */
            align-items: center;
            text-align: left;
            padding: 1rem; /* Adjust padding for content */
            overflow: hidden; /* Hide overflowing book during animation */
        }

        .fortune-card-text {
            font-family: 'Metal Mania', cursive; /* Mystical text font */
            color: #ffd700;
            font-size: 1.8rem;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            text-align: center;
        }

        /* Mystical Sparkle Effect */
        .fortune-card-wrapper::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            /* Use transform: scale for animation instead of width/height */
            background: radial-gradient(circle at center, #ffd700 0%, transparent 70%);
            border-radius: 50%;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0);
            z-index: 3; /* Above the card faces */
            pointer-events: none; /* Allow clicks to pass through */
        }

        .fortune-card-wrapper.sparkle::before {
            animation: sparkle-burst 0.7s ease-out forwards;
        }

        @keyframes sparkle-burst {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }
            30% {
                opacity: 0.7;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.5);
            }
        }

        /* Fullscreen Overlay */
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.8); /* Dark overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s;
            z-index: 1000; /* Above everything else */
        }

        .fullscreen-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .fullscreen-card-content {
            background-color: #f5f5dc;
            color: #333;
            border-radius: 15px;
            padding: 2rem;
            max-width: 800px; /* Max width for fullscreen card */
            width: 90%;
            max-height: 90vh; /* Max height for fullscreen card */
            overflow-y: auto; /* Enable scrolling for long content */
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            transform: scale(0.8); /* Initial state for pop-in */
            opacity: 0;
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
        }

        .fullscreen-overlay.active .fullscreen-card-content {
            transform: scale(1);
            opacity: 1;
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #8b4513;
            color: #ffd700;
            border: 2px solid #ffd700;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001; /* Ensure button is clickable */
            transition: background 0.2s, color 0.2s;
        }

        .close-button:hover {
            background: #ffd700;
            color: #8b4513;
        }

        .book-image {
            max-width: 200px; /* Larger for fullscreen */
            height: auto;
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            opacity: 0; /* Initially hidden for pop-out effect */
            transform: scale(0.8) translateY(20px); /* Initial state for pop-out */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .book-image.show {
            opacity: 1;
            transform: scale(1) translateY(0);
        }

        .book-title {
            font-size: 1.8rem; /* Larger for fullscreen */
            font-weight: bold;
            color: #4a0e0e;
            margin-bottom: 0.75rem;
            text-align: center;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease-out 0.1s, transform 0.5s ease-out 0.1s;
        }

        .book-title.show {
            opacity: 1;
            transform: translateY(0);
        }

        .book-author {
            font-size: 1.3rem; /* Larger for fullscreen */
            color: #8b4513;
            margin-bottom: 1rem;
            text-align: center;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease-out 0.2s, transform 0.5s ease-out 0.2s;
        }

        .book-author.show {
            opacity: 1;
            transform: translateY(0);
        }

        .book-blurb {
            font-size: 1rem;
            line-height: 1.6;
            color: #555;
            text-align: justify;
            margin-bottom: 1.25rem;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease-out 0.3s, transform 0.5s ease-out 0.3s;
        }

        .book-blurb.show {
            opacity: 1;
            transform: translateY(0);
        }

        .book-sign {
            font-size: 1.1rem;
            font-style: italic;
            font-weight: bold;
            color: #4a0e0e; /* Dark red for sign */
            text-align: center;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease-out 0.4s, transform 0.5s ease-out 0.4s;
        }

        .book-sign.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Responsive adjustments for fullscreen */
        @media (max-width: 768px) {
            .fullscreen-card-content {
                padding: 1.5rem;
            }
            .book-image {
                max-width: 150px;
            }
            .book-title {
                font-size: 1.5rem;
            }
            .book-author {
                font-size: 1.1rem;
            }
            .book-blurb {
                font-size: 0.9rem;
            }
            .book-sign {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .fullscreen-card-content {
                padding: 1rem;
            }
            .book-image {
                max-width: 120px;
            }
            .book-title {
                font-size: 1.3rem;
            }
            .book-author {
                font-size: 1rem;
            }
            .book-blurb {
                font-size: 0.85rem;
            }
            .book-sign {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
<div class="zoltar-container">
    <div class="zoltar-header-image-container">
        <img src="Gemini_Generated_Image_5xddfz5xddfz5xdd.pn" alt="Philip's Book Diviner" class="zoltar-header-image">
    </div>
    <p class="text-gray-300 mb-6">Click the card to reveal your next literary adventure!</p>

    <div id="fortuneCardWrapper" class="fortune-card-wrapper">
        <div id="fortuneCardFront" class="fortune-card-face fortune-card-front">
            <p class="fortune-card-text">Tap for Wisdom</p>
            <p class="fortune-card-text text-sm mt-2">Your Future Read Awaits</p>
        </div>
        <div id="fortuneCardBack" class="fortune-card-face fortune-card-back">
            <!-- Book content will be dynamically loaded here for the small card view -->
            <img id="smallBookImage" class="book-image" src="" alt="Book Cover">
            <p id="smallBookTitle" class="book-title font-bold"></p>
            <p id="smallBookAuthor" class="book-author"></p>
            <p id="smallBookSign" class="book-sign italic font-bold"></p>
        </div>
    </div>
</div>

<!-- Fullscreen Overlay for Book Details -->
<div id="fullscreenOverlay" class="fullscreen-overlay">
    <div class="fullscreen-card-content">
        <button id="closeButton" class="close-button">X</button>
        <img id="fullscreenBookImage" class="book-image" src="" alt="Book Cover">
        <p id="fullscreenBookTitle" class="book-title font-bold"></p>
        <p id="fullscreenBookAuthor" class="book-author"></p>
        <p id="fullscreenBookBlurb" class="book-blurb"></p>
        <p id="fullscreenBookSign" class="book-sign italic font-bold"></p>
    </div>
</div>

<script>
    // Array of book recommendations
    const allBooks = [
        {
            title: "Oranges",
            author: "John McPhee",
            blurb: "I know, seriously, a book on oranges? But it’s incredibly written. John McPhee, 94, is the godfather of the Princeton journalism department. I helped him up the stairs once and I haven’t washed that arm since (just kidding…).",
            sign: "Sign: Learn how good storytelling can make even mundane topics shine.",
            imageUrl: "71bxytN5LoL._UF1000,1000_QL80_.jpg"
        }
        // Add more books here as you provide them
        /*
        ,
        {
            title: "Another Book",
            author: "Another Author",
            blurb: "This is a blurb for another book.",
            sign: "This is another sign.",
            imageUrl: "URL_TO_ANOTHER_BOOK_COVER"
        }
        */
    ];

    let availableBooks = []; // Books not yet seen in the current cycle
    let seenBooks = []; // Books already seen in the current cycle

    const fortuneCardWrapper = document.getElementById('fortuneCardWrapper');
    const fortuneCardFront = document.getElementById('fortuneCardFront');
    const fortuneCardBack = document.getElementById('fortuneCardBack');

    // Elements for the small card view
    const smallBookImage = document.getElementById('smallBookImage');
    const smallBookTitle = document.getElementById('smallBookTitle');
    const smallBookAuthor = document.getElementById('smallBookAuthor');
    const smallBookSign = document.getElementById('smallBookSign');

    // Elements for the fullscreen overlay
    const fullscreenOverlay = document.getElementById('fullscreenOverlay');
    const fullscreenCardContent = document.getElementById('fullscreenCardContent');
    const closeButton = document.getElementById('closeButton');
    const fullscreenBookImage = document.getElementById('fullscreenBookImage');
    const fullscreenBookTitle = document.getElementById('fullscreenBookTitle');
    const fullscreenBookAuthor = document.getElementById('fullscreenBookAuthor');
    const fullscreenBookBlurb = document.getElementById('fullscreenBookBlurb');
    const fullscreenBookSign = document.getElementById('fullscreenBookSign');

    let currentBook = null; // Stores the book currently being displayed

    // Function to shuffle an array (Fisher-Yates algorithm)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Initialize available books and preload images
    function initializeBooks() {
        availableBooks = shuffleArray([...allBooks]); // Start with a shuffled copy of all books
        seenBooks = []; // Reset seen books
        // Preload all book cover images
        const imageUrls = allBooks.map(book => book.imageUrl);
        preloadImages(imageUrls);
    }

    // Function to preload images
    function preloadImages(imageUrls) {
        imageUrls.forEach(url => {
            const img = new Image();
            img.src = url;
        });
    }

    fortuneCardWrapper.addEventListener('click', handleCardClick);
    closeButton.addEventListener('click', closeFullscreen);

    function handleCardClick() {
        // Always trigger sparkle effect on click
        fortuneCardWrapper.classList.add('sparkle');
        setTimeout(() => {
            fortuneCardWrapper.classList.remove('sparkle');
        }, 700); // Match sparkle animation duration

        if (fortuneCardWrapper.classList.contains('flipped')) {
            // If card is currently flipped (showing book on back), flip it back to front
            fortuneCardWrapper.classList.remove('flipped');
            // Hide book details immediately for a clean transition
            hideBookDetails();
            // After flipping back, the next click will reveal a new book
        } else {
            // If card is on front, reveal a new book
            revealNewBook();
        }
    }

    function revealNewBook() {
        let selectedBook;

        if (availableBooks.length === 0) {
            // All books have been seen, display the "game over" card
            selectedBook = {
                title: "Oops! I have revealed too much.",
                author: "",
                blurb: "My mystical energies are depleted for now. The secrets of the cosmos must rest.",
                sign: "Come back next month. Read… if you dare.",
                imageUrl: "https://placehold.co/150x225/000000/FFFFFF?text=Zoltar+Resting" // Placeholder for end card
            };
            // Reset for next cycle if user wants to start over
            setTimeout(() => {
                initializeBooks();
            }, 3000); // Reset after 3 seconds
        } else {
            // Get a random book from availableBooks
            const randomIndex = Math.floor(Math.random() * availableBooks.length);
            selectedBook = availableBooks[randomIndex];

            // Move the selected book from available to seen
            availableBooks.splice(randomIndex, 1);
            seenBooks.push(selectedBook);
        }

        currentBook = selectedBook; // Store the current book

        // Update the content on the back of the small card
        smallBookImage.src = currentBook.imageUrl;
        smallBookTitle.textContent = currentBook.title;
        smallBookAuthor.textContent = `By ${currentBook.author}`;
        smallBookSign.textContent = currentBook.sign;

        // Trigger the flip to reveal the book on the small card
        fortuneCardWrapper.classList.add('flipped');

        // After the flip animation, transition to fullscreen
        setTimeout(() => {
            showFullscreenBook();
        }, 600); // Match card flip duration
    }

    function showFullscreenBook() {
        // Populate fullscreen content
        fullscreenBookImage.src = currentBook.imageUrl;
        fullscreenBookTitle.textContent = currentBook.title;
        fullscreenBookAuthor.textContent = `By ${currentBook.author}`;
        fullscreenBookBlurb.textContent = currentBook.blurb;
        fullscreenBookSign.textContent = currentBook.sign;

        // Activate fullscreen overlay
        fullscreenOverlay.classList.add('active');

        // Show details with pop-in animation after overlay is active
        setTimeout(() => {
            fullscreenBookImage.classList.add('show');
            fullscreenBookTitle.classList.add('show');
            fullscreenBookAuthor.classList.add('show');
            fullscreenBookBlurb.classList.add('show');
            fullscreenBookSign.classList.add('show');
        }, 100); // Small delay after overlay active
    }

    function closeFullscreen() {
        // Hide details with pop-out animation
        hideFullscreenDetails();

        // Deactivate fullscreen overlay after animation
        setTimeout(() => {
            fullscreenOverlay.classList.remove('active');
        }, 500); // Match pop-out transition duration

        // Flip the small card back to its front side
        fortuneCardWrapper.classList.remove('flipped');
        // Hide small card details immediately for a clean transition
        hideBookDetails();
    }

    function hideBookDetails() {
        smallBookImage.classList.remove('show');
        smallBookTitle.classList.remove('show');
        smallBookAuthor.classList.remove('show');
        smallBookSign.classList.remove('show');
    }

    function hideFullscreenDetails() {
        fullscreenBookImage.classList.remove('show');
        fullscreenBookTitle.classList.remove('show');
        fullscreenBookAuthor.classList.remove('show');
        fullscreenBookBlurb.classList.remove('show');
        fullscreenBookSign.classList.remove('show');
    }


    // Initial setup
    document.addEventListener('DOMContentLoaded', () => {
        initializeBooks(); // Shuffle and preload on load
        fortuneCardWrapper.classList.remove('flipped');
        hideBookDetails(); // Ensure small card details are hidden
        hideFullscreenDetails(); // Ensure fullscreen details are hidden
        fullscreenOverlay.classList.remove('active'); // Ensure overlay is hidden

        // Set initial placeholder for small card
        smallBookImage.src = "https://placehold.co/150x225/000000/FFFFFF?text=Click+Card";
        smallBookTitle.textContent = "Your Literary Journey Awaits...";
        smallBookAuthor.textContent = "Click the card to discover your next read.";
        smallBookSign.textContent = "";
    });

</script>
</body>
</html>
